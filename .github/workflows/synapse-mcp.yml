name: Synapse MCP Server

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  synapse-mcp:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/pmaojo/synapse-engine:latest
    steps:
      - name: Start Synapse MCP
        run: |
          # Start in MCP mode
          /synapse --mcp &
          sleep 2
          
      - name: Test MCP tools
        run: |
          echo '{"jsonrpc":"2.0","id":1,"method":"tools/list"}' | nc localhost 50051 || true
          
  test-connection:
    runs-on: ubuntu-latest
    needs: synapse-mcp
    steps:
      - name: Test Python SDK connection
        run: |
          pip install synapse-sdk
          python -c "from synapse import get_client; print('SDK OK')"
